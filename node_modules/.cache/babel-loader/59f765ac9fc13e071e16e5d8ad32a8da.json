{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/Andy Kwan/Desktop/ryan_subs/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Andy Kwan/Desktop/ryan_subs/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Andy Kwan\\\\Desktop\\\\ryan_subs\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useEffect,useState,useContext}from'react';import{useHistory}from'react-router-dom';import axios from'axios';import PriceCard from'../components/cards/PriceCard';import UserContext from'../context';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var _useContext=useContext(UserContext),_useContext2=_slicedToArray(_useContext,2),state=_useContext2[0],setState=_useContext2[1];var _useState=useState(),_useState2=_slicedToArray(_useState,2),prices=_useState2[0],setPrices=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),userSubscriptions=_useState4[0],setUserSubscriptions=_useState4[1];var history=useHistory();useEffect(function(){fetchPrices();},[]);useEffect(function(){var _state$user,_state$user$subscript;var result=[];state===null||state===void 0?void 0:(_state$user=state.user)===null||_state$user===void 0?void 0:(_state$user$subscript=_state$user.subscriptions)===null||_state$user$subscript===void 0?void 0:_state$user$subscript.forEach(function(sub){if(sub.status==='active')result.push(sub.plan.id);});setUserSubscriptions(result);},[state]);var fetchPrices=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/prices');case 2:_yield$axios$get=_context.sent;data=_yield$axios$get.data;setPrices(data);case 5:case\"end\":return _context.stop();}}},_callee);}));return function fetchPrices(){return _ref.apply(this,arguments);};}();var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e,price){var _yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(userSubscriptions&&userSubscriptions.includes(price.id))){_context2.next=3;break;}return _context2.abrupt(\"return\",history.push(\"/\".concat(price.nickname.toLowerCase())));case 3:if(!(!state||!state.token)){_context2.next=5;break;}return _context2.abrupt(\"return\",history.push('/register'));case 5:_context2.next=7;return axios.post('/create-subscription',{priceId:price.id});case 7:_yield$axios$post=_context2.sent;data=_yield$axios$post.data;window.open(data);case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function handleClick(_x,_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row col-md-6 offset-md-3 text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"pt-5 fw-bold\",children:\"Explore the right plan for your business\"}),/*#__PURE__*/_jsx(\"p\",{className:\"lead pb-4\",children:\"Choose the plan that suites you best!\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row pt-5 mb-3 text-center\",children:prices&&prices.map(function(price){return/*#__PURE__*/_jsx(PriceCard,{price:price,handleSubscription:handleClick,userSubscriptions:userSubscriptions},price.id);})})]});};export default Home;","map":{"version":3,"sources":["C:/Users/Andy Kwan/Desktop/ryan_subs/client/src/pages/Home.js"],"names":["useEffect","useState","useContext","useHistory","axios","PriceCard","UserContext","Home","state","setState","prices","setPrices","userSubscriptions","setUserSubscriptions","history","fetchPrices","result","user","subscriptions","forEach","sub","status","push","plan","id","get","data","handleClick","e","price","preventDefault","includes","nickname","toLowerCase","token","post","priceId","window","open","map"],"mappings":"gZAAA,OAASA,SAAT,CAAoBC,QAApB,CAA8BC,UAA9B,KAAgD,OAAhD,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,MAAOC,CAAAA,SAAP,KAAsB,+BAAtB,CACA,MAAOC,CAAAA,WAAP,KAAwB,YAAxB,C,wFAEA,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,EAAM,CACf,gBAA0BL,UAAU,CAACI,WAAD,CAApC,4CAAOE,KAAP,iBAAcC,QAAd,iBACA,cAA4BR,QAAQ,EAApC,wCAAOS,MAAP,eAAeC,SAAf,eACA,eAAkDV,QAAQ,CAAC,EAAD,CAA1D,yCAAOW,iBAAP,eAA0BC,oBAA1B,eACA,GAAMC,CAAAA,OAAO,CAAGX,UAAU,EAA1B,CAEAH,SAAS,CAAC,UAAM,CACZe,WAAW,GACd,CAFQ,CAEN,EAFM,CAAT,CAIAf,SAAS,CAAC,UAAM,uCACZ,GAAIgB,CAAAA,MAAM,CAAG,EAAb,CACAR,KAAK,OAAL,EAAAA,KAAK,SAAL,qBAAAA,KAAK,CAAES,IAAP,yEAAaC,aAAb,sEAA4BC,OAA5B,CAAoC,SAAAC,GAAG,CAAI,CACvC,GAAIA,GAAG,CAACC,MAAJ,GAAe,QAAnB,CAA6BL,MAAM,CAACM,IAAP,CAAYF,GAAG,CAACG,IAAJ,CAASC,EAArB,EAChC,CAFD,EAGAX,oBAAoB,CAACG,MAAD,CAApB,CACH,CANQ,CAMN,CAACR,KAAD,CANM,CAAT,CAQA,GAAMO,CAAAA,WAAW,0FAAG,mLACOX,CAAAA,KAAK,CAACqB,GAAN,CAAU,SAAV,CADP,uCACRC,IADQ,kBACRA,IADQ,CAEhBf,SAAS,CAACe,IAAD,CAAT,CAFgB,sDAAH,kBAAXX,CAAAA,WAAW,0CAAjB,CAKA,GAAMY,CAAAA,WAAW,2FAAG,kBAAOC,CAAP,CAAUC,KAAV,iJAChBD,CAAC,CAACE,cAAF,GADgB,KAEZlB,iBAAiB,EAAIA,iBAAiB,CAACmB,QAAlB,CAA2BF,KAAK,CAACL,EAAjC,CAFT,4DAGLV,OAAO,CAACQ,IAAR,YAAiBO,KAAK,CAACG,QAAN,CAAeC,WAAf,EAAjB,EAHK,cAKZ,CAACzB,KAAD,EAAU,CAACA,KAAK,CAAC0B,KALL,4DAKmBpB,OAAO,CAACQ,IAAR,CAAa,WAAb,CALnB,gCAOOlB,CAAAA,KAAK,CAAC+B,IAAN,CAAW,sBAAX,CAAmC,CACtDC,OAAO,CAAEP,KAAK,CAACL,EADuC,CAAnC,CAPP,yCAORE,IAPQ,mBAORA,IAPQ,CAWhBW,MAAM,CAACC,IAAP,CAAYZ,IAAZ,EAXgB,yDAAH,kBAAXC,CAAAA,WAAW,iDAAjB,CAcA,mBACI,aAAK,SAAS,CAAC,iBAAf,wBACI,aAAK,SAAS,CAAC,sCAAf,wBACI,WAAI,SAAS,CAAC,cAAd,sDADJ,cAEI,UAAG,SAAS,CAAC,WAAb,mDAFJ,GADJ,cAKI,YAAK,SAAS,CAAC,2BAAf,UACKjB,MAAM,EAAIA,MAAM,CAAC6B,GAAP,CAAW,SAAAV,KAAK,qBACvB,KAAC,SAAD,EAEI,KAAK,CAAEA,KAFX,CAGI,kBAAkB,CAAEF,WAHxB,CAII,iBAAiB,CAAEf,iBAJvB,EACSiB,KAAK,CAACL,EADf,CADuB,EAAhB,CADf,EALJ,GADJ,CAkBH,CAvDD,CAyDA,cAAejB,CAAAA,IAAf","sourcesContent":["import { useEffect, useState, useContext } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nimport PriceCard from '../components/cards/PriceCard';\r\nimport UserContext from '../context';\r\n\r\nconst Home = () => {\r\n    const [state, setState] = useContext(UserContext);\r\n    const [prices, setPrices] = useState();\r\n    const [userSubscriptions, setUserSubscriptions] = useState([]);\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        fetchPrices();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let result = [];\r\n        state?.user?.subscriptions?.forEach(sub => {\r\n            if (sub.status === 'active') result.push(sub.plan.id);\r\n        });\r\n        setUserSubscriptions(result);\r\n    }, [state]);\r\n\r\n    const fetchPrices = async () => {\r\n        const { data } = await axios.get('/prices');\r\n        setPrices(data);\r\n    };\r\n\r\n    const handleClick = async (e, price) => {\r\n        e.preventDefault();\r\n        if (userSubscriptions && userSubscriptions.includes(price.id)) {\r\n            return history.push(`/${price.nickname.toLowerCase()}`);\r\n        }\r\n        if (!state || !state.token) return history.push('/register');\r\n\r\n        const { data } = await axios.post('/create-subscription', {\r\n            priceId: price.id,\r\n        });\r\n\r\n        window.open(data);\r\n    };\r\n\r\n    return (\r\n        <div className=\"container-fluid\">\r\n            <div className=\"row col-md-6 offset-md-3 text-center\">\r\n                <h1 className=\"pt-5 fw-bold\">Explore the right plan for your business</h1>\r\n                <p className=\"lead pb-4\">Choose the plan that suites you best!</p>\r\n            </div>\r\n            <div className=\"row pt-5 mb-3 text-center\">\r\n                {prices && prices.map(price => (\r\n                    <PriceCard \r\n                        key={price.id} \r\n                        price={price}\r\n                        handleSubscription={handleClick}\r\n                        userSubscriptions={userSubscriptions}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}